import{$ as P,a as k,au as R,r,j as e,S as E,B as p,b as L}from"./index-nRz7PDd4.js";import{T as z}from"./TableLisiting-ByMm-dXm.js";import{B as T,a as $,b as K,c as M}from"./breadcrumb-gFg8juDx.js";import{d as l}from"./dateFormatter-CQy79qr9.js";import{A as O,a as F,b as Q}from"./index-3zwKqybI.js";import{C as U}from"./CustomSkeletons-D9FdukaD.js";import{M as J}from"./move-left-DmJWLqcQ.js";import{B as G}from"./banknote-DnmEgTIk.js";import{C as H}from"./calendar-days-u-qCTdjE.js";const re=()=>{const v=P(),h=k(),{requirementId:u}=R(),o=v.state?.products||[],[c,j]=r.useState(null),[y,A]=r.useState([]),[D,w]=r.useState([]),[n,I]=r.useState(null),[g,N]=r.useState(!0),[x,b]=r.useState("");let i=r.useRef(null);r.useEffect(()=>{(async()=>{if(u)try{const s=await L.getRequirementById(u);I(s),N(!1)}catch(s){console.error("Error fetching requirement data:",s),N(!1)}})()},[u]),r.useEffect(()=>{if(n){const a=n||(o&&o.length>0?o[0]:null);if(a){if(j(a),a.product){const s=[a.product,...a.product.subProducts||[]];w(s)}if(a.sellers&&a.sellers.length>0){const s=a.sellers.map(t=>({avtar:t.seller?.profileImage,date:t.date?l(t.date):t.createdAt?l(t.createdAt):a.createdAt?l(a.createdAt):"N/A",bid_buy:`${t.seller?.firstName||""} ${t.seller?.lastName||""}`.trim()||"Anonymous Seller",bid_amount:t.budgetAmount?`â‚¹${t.budgetAmount}`:"N/A",chat_message:t.message||"Interested in your requirement",action:"chat",sellerId:t.seller?._id||t._id||t.userId,location:t.seller?.currentLocation||t.seller?.address,status:t.seller?.status}));A(s)}}}},[n,o]);const _=(a,s,t)=>{c&&(localStorage.setItem("chatIds",JSON.stringify({productId:c.product?._id,buyerId:c.buyer?._id,sellerId:a})),h("/chat",{state:{productId:c.product?._id,buyerId:c.buyer?._id,sellerId:a,partnerName:s,partnerAvatar:t}}))},B=[{accessorKey:"avtar",header:"",size:60,cell:({row:a})=>{const s=a.original.avtar,t=a.original.bid_buy||"NA",d=t.split(" ").map(f=>f[0]).join("").toUpperCase();return e.jsx("div",{className:"*:data-[slot=avatar]:ring-background flex -space-x-2 *:data-[slot=avatar]:ring-2",children:e.jsxs(O,{className:"w-10 h-10",children:[e.jsx(F,{src:s,alt:t,className:"rounded-full w-full h-full object-cover"}),e.jsx(Q,{className:"bg-gray-200 rounded-full flex w-full h-full  items-center justify-center text-sm font-semibold",children:d})]})})}},{accessorKey:"date",header:"Date"},{accessorKey:"bid_buy",header:"Seller"},{accessorKey:"bid_amount",header:"Quoted Price"},{accessorKey:"location",header:"Location"},{accessorKey:"action",header:"Action",cell:({row:a})=>e.jsx(p,{className:"text-sm cursor-pointer text-orange-600 underline",variant:"link",onClick:()=>_(a.original.sellerId,a.original.bid_buy,a.original.avtar),children:"Chat Now"})}];return r.useEffect(()=>{if(!n?.createdAt||!n?.product?.bidActiveDuration)return;const a=new Date(n.createdAt).getTime(),s=Number(n.product.bidActiveDuration),t=a+s*24*60*60*1e3,d=()=>{const f=Date.now(),m=t-f;if(m<=0){b("Expired"),i.current&&clearInterval(i.current);return}const S=Math.floor(m/(1e3*60*60)),q=Math.floor(m%(1e3*60*60)/(1e3*60)),C=Math.floor(m%(1e3*60)/1e3);b(`${S}h ${q}m ${C}s`)};return d(),i.current=setInterval(d,1e3),()=>{i.current&&clearInterval(i.current)}},[n]),g?e.jsx(U,{}):c?e.jsxs("div",{className:"w-full max-w-7xl mx-auto space-y-3 p-4",children:[e.jsx(T,{className:"sm:block hidden",children:e.jsx($,{children:e.jsxs(K,{className:"flex items-center gap-2 cursor-pointer",onClick:()=>h(-1),children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx(M,{className:"capitalize font-semibold text-gray-500 text-[15px]",children:"Requirement Detail's"})]})})}),D.map((a,s)=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6  p-4",children:[e.jsx("div",{className:"lg:col-span-4 bg-gray-100 flex justify-center items-center rounded-lg p-4 h-48",children:e.jsx("img",{src:a.image||"/no-image.webp",alt:a.title||"Product",className:"object-contain h-full w-full rounded-lg mix-blend-darken"})}),e.jsxs("div",{className:"lg:col-span-8 p-4 space-y-2",children:[e.jsxs("h2",{className:"text-sm font-medium mb-2",children:["Date: ",l(a.createdAt)||"N/A"]}),g||!x?e.jsx(E,{className:"h-8 w-24 rounded-full float-end"}):x!=="Expired"?e.jsx(p,{variant:"ghost",className:"float-end border rounded-full hover:bg-orange-700 hover:text-white text-sm bg-orange-700 text-white",children:x}):e.jsx(p,{variant:"ghost",className:"float-end border rounded-full hover:bg-orange-700 hover:text-white text-sm bg-orange-700 text-white",children:"Expired"}),e.jsx("h2",{className:"text-xl font-bold capitalize",children:a.title||"N/A"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description||"No description available"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2 pr-3 border-r-2 py-1",children:[e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(G,{className:"w-5 h-5"}),e.jsx("span",{className:"capitalize",children:"Quantity:"})]}),e.jsx("span",{className:"font-semibold",children:a.quantity||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"capitalize",children:"Delivery By:"})]}),e.jsx("span",{className:"font-semibold",children:a.paymentAndDelivery?.ex_deliveryDate?l(a.paymentAndDelivery.ex_deliveryDate):"N/A"})]})]}),a.brand&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Brand:"}),e.jsx("span",{className:"text-gray-600 capitalize",children:a.brand})]}),a.conditionOfProduct&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium",children:"Condition:"}),e.jsx("span",{className:"text-gray-600 capitalize",children:a.conditionOfProduct.replace("_"," ")})]})]})]},s)),e.jsx("div",{className:"bg-orange-50 p-4 rounded-md",children:e.jsx(z,{data:y,columns:B,filters:!1,title:"Quote Recevied ",target:"requirementOverview",colorPalette:"orange"})})]}):e.jsx("div",{className:"w-full max-w-7xl mx-auto space-y-6 p-4",children:e.jsx("div",{className:"text-center",children:"No product data available"})})};export{re as default};
