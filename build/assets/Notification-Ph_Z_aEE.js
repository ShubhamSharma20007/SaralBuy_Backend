import{r as p,a as q,b as $,j as t,B as h,a7 as O,aa as V,ab as P,ac as Q,ad as U,ae as Y,a0 as G}from"./index-nRz7PDd4.js";import{A as H}from"./AlertPopup-DJCRSOvE.js";import{L as J}from"./list-filter-CR24f6YA.js";import{T as I}from"./trash-2-C9C2rXVf.js";import"./alert-dialog-DvHQnZ2k.js";const M=(s,o,a)=>`product_${s}_buyer_${o}_seller_${a}`,N=(s,o)=>{let a=s.productId?._id||s.productId,d=s.buyerId?._id||s.buyerId,r=s.sellerId?._id||s.sellerId;if(!a&&s.deal?.productId&&(a=s.deal.productId),!d&&s.deal?.buyerId&&(d=s.deal.buyerId),!r&&s.deal?.sellerId&&(r=s.deal.sellerId||s.deal?.sellerDetails?.sellerId),!a||!d||!r){const l=G.getState().recentChats.find(m=>m.productId?._id===s.productId||m.productId===s.productId);l&&(a=l.productId?._id||l.productId,d=l.buyerId?._id||l.buyerId,r=l.sellerId?._id||l.sellerId)}if(a&&d&&r){const j=M(a,d,r),l={productId:a,buyerId:d,sellerId:r,roomId:j};localStorage.setItem("chatIds",JSON.stringify(l)),o("/chat",{state:l})}else o("/chat")},se=()=>{const[s,o]=p.useState([]),[a,d]=p.useState(!0),[r,j]=p.useState(null),[l,m]=p.useState(!1),[C,_]=p.useState(null),[A,D]=p.useState(!1),g=q(),[W,k]=p.useState(!1),B={title:"Warning",message:"This action cannot be undone. This will permanently delete your notification."};p.useEffect(()=>{d(!0),$.getBidNotifications().then(e=>{o(Array.isArray(e)?e:[]),d(!1)}).catch(e=>{e=e?.response?.data?.message||e?.response?.data?.error?.message||e.message||e,console.log(e),e==="Token not found"&&window.dispatchEvent(new CustomEvent("session-expired")),d(!1)})},[]);const T=()=>{k(e=>{const n=!e;return o(c=>Array.isArray(c)?[...c].sort((u,b)=>{const x=new Date(u.createdAt).getTime(),v=new Date(b.createdAt).getTime();return n?x-v:v-x}):c),n})},y=e=>{_(e),m(!0)},L=async()=>{if(C){D(!0);try{await $.deleteNotification(C),o(e=>e.filter(n=>n._id!==C)),m(!1),_(null)}catch(e){console.error("Failed to delete notification:",e),j("Failed to delete notification")}finally{D(!1),m(!1)}}};return t.jsxs("div",{className:"grid space-y-5",children:[t.jsxs("div",{className:"flex justify-between items-center mb-3",children:[t.jsx("p",{className:"font-bold text-xl whitespace-nowrap tracking-tight text-gray-600",children:"Notifications"}),t.jsxs(h,{onClick:T,variant:"ghost",size:"icon",className:"w-24 flex gap-2 items-center justify-center text-sm font-medium text-gray-700 bg-transparent border-1 hover:bg-transparent cursor-pointer border-gray-700",children:["Date",t.jsx(J,{className:"w-5 h-5"})]})]}),a&&t.jsx("div",{className:"text-center text-gray-500",children:"Loading..."}),r&&t.jsx("div",{className:"text-center text-red-500",children:r}),!a&&!r&&s.length===0&&t.jsxs("div",{className:"text-center text-gray-500 h-[60vh] flex  justify-center items-center flex-col",children:[t.jsx("img",{alt:"",className:"h-28 w-28",src:"/empty-cart.webp"}),t.jsx("p",{className:"text-gray-500 text-sm",children:" No notifications found."})]}),!a&&!r&&s?.flatMap((e,n)=>{const c=e.title?.toLowerCase()||"",f=c.includes("rated chat"),u=c.includes("deal accepted"),b=c.includes("deal rejected"),x=c.includes("close deal request")||c.includes("deal request"),v=x||u||b;if(f)return t.jsxs("div",{children:[t.jsxs("div",{className:`p-4 grid ${n%2===0?"bg-orange-100/50":"bg-transparent"} rounded-md space-y-2 relative group`,children:[t.jsx(h,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>y(e._id||""),children:t.jsx(I,{className:"h-4 w-4"})}),t.jsx("div",{className:"grid grid-cols-3 items-center gap-5",children:t.jsxs("p",{className:"text-md font-bold text-gray-800 capitalize col-span-2 flex items-center gap-2",children:[t.jsx(O,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),e.title]})}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600 line-clamp-2 col-span-2",children:e.description}),t.jsx("p",{className:"text-sm text-gray-600 col-span-1 text-right underline cursor-pointer",onClick:()=>N(e,g),children:"View"})]})]}),t.jsx("div",{className:"border-b-2 pt-2 mx-[0.5px]"})]},e._id);if(v){const i=x?"text-blue-500":u?"text-green-500":"text-red-500",w=x?"fill-blue-500":u?"fill-green-500":"fill-red-500";return t.jsxs("div",{children:[t.jsxs("div",{className:`p-4 grid ${n%2===0?"bg-orange-100/50":"bg-transparent"} rounded-md space-y-2 relative group`,children:[t.jsx(h,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-8 w-8 text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>y(e._id||""),children:t.jsx(I,{className:"h-4 w-4"})}),t.jsx("div",{className:"grid grid-cols-3 items-center gap-5",children:t.jsxs("p",{className:"text-md font-bold text-gray-800 capitalize col-span-2 flex items-center gap-2",children:[x&&t.jsx(V,{className:`w-5 h-5 ${i} ${w}`}),u&&t.jsx(P,{className:`w-5 h-5 ${i}`}),b&&t.jsx(Q,{className:`w-5 h-5 ${i}`}),e.title]})}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[t.jsx("p",{className:"text-sm font-medium text-gray-600 line-clamp-2 col-span-2",children:e.description}),t.jsx("p",{className:"text-sm text-gray-600 col-span-1 text-right underline cursor-pointer",onClick:()=>N(e,g),children:"View"})]})]}),t.jsx("div",{className:"border-b-2 pt-2 mx-[0.5px]"})]},e._id)}const S=e.productId&&typeof e.productId=="object"&&e.productId.title?e.productId.title.charAt(0).toUpperCase()+e.productId.title.slice(1):e.product?.title?e.product.title.charAt(0).toUpperCase()+e.product.title.slice(1):"Product";if(Array.isArray(e.allBids)&&e.allBids.length>0)return e.allBids.map((i,w)=>{const R=i.seller?`${i.seller.firstName} ${i.seller.lastName}`:"Seller",F=i.date?new Date(i.date).toLocaleDateString():"";return e.productId&&typeof e.productId=="object"?e.productId._id:typeof e.productId=="string"?e.productId:e.product&&e.product._id&&e.product._id,t.jsxs("div",{children:[t.jsxs("div",{className:`p-4 grid ${w%2===0?"bg-orange-100/50":"bg-transparent"} rounded-md space-y-2 relative group`,children:[t.jsx(h,{variant:"ghost",size:"icon",className:"hover:bg-red-100 p-1 rounded-md ease-in-out transition-all duration-300 absolute top-2 right-2 h-8 w-8 text-red-500 hover:text-red-600 cursor-pointer",onClick:()=>y(e._id||""),children:t.jsx(I,{className:" h-4 w-4  text-red-500 cursor-pointer rounded-full"})}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[t.jsx("p",{className:"text-md font-bold text-gray-800 capitalize col-span-2",children:"New Bid Received"}),t.jsx("p",{className:"text-sm text-orange-500 col-span-1 text-right",children:F})]}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[t.jsxs("p",{className:"text-sm font-medium text-gray-600 line-clamp-1 col-span-2",children:["You have got a new Quote on ",t.jsx("span",{className:"font-semibold decoration-red-500",children:S})," by ",t.jsx("span",{className:"font-semibold decoration-red-500",children:R}),"."]}),t.jsx("p",{className:"text-sm text-gray-600 col-span-1 text-right underline cursor-pointer",onClick:()=>N(e,g),children:"View"})]})]}),t.jsx("div",{className:"border-b-2 pt-2 mx-[0.5px]"})]},`${e._id}-${w}`)});const z=e.latestBid?.seller?`${e.latestBid.seller.firstName} ${e.latestBid.seller.lastName}`:"Seller",E=e.latestBid?.date?new Date(e.latestBid.date).toLocaleDateString():"";return e.productId&&typeof e.productId=="object"?e.productId._id:typeof e.productId=="string"?e.productId:e.product&&e.product._id&&e.product._id,t.jsxs("div",{children:[t.jsxs("div",{className:`p-4 grid ${n%2===0?"bg-orange-100/50":"bg-transparent"} rounded-md space-y-2 relative group`,children:[t.jsx(h,{variant:"ghost",size:"icon",className:"hover:bg-red-100 p-1 rounded-md ease-in-out transition-all duration-300 absolute top-2 right-2 h-8 w-8 text-red-500 hover:text-red-600 cursor-pointer",onClick:()=>y(e._id||""),children:t.jsx(I,{className:"h-4 w-4  text-red-500 cursor-pointer rounded-full"})}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[t.jsxs("p",{className:"text-md font-bold text-gray-800 capitalize col-span-2 flex items-center gap-2",children:[e.title==="Deal Closed"?t.jsx(U,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}):t.jsx(Y,{className:"w-5 h-5 text-yellow-500 fill-yellow-500"}),e.title]}),t.jsx("p",{className:"text-sm text-orange-500 col-span-1 text-right",children:E})]}),t.jsxs("div",{className:"grid grid-cols-3 items-center gap-5",children:[e.title?.match(/Deal Closed/)?t.jsx("p",{className:"text-sm font-medium text-gray-600 line-clamp-1 col-span-2",children:e.description}):t.jsxs("p",{className:"text-sm font-medium text-gray-600 line-clamp-1 col-span-2",children:["You have got a new Quote on ",t.jsx("span",{className:"font-semibold decoration-red-500",children:S})," by ",t.jsx("span",{className:"font-semibold decoration-red-500",children:z}),"."]}),t.jsx("p",{className:"text-sm text-gray-600 col-span-1 text-right underline cursor-pointer",onClick:()=>{e.title?.match(/Deal Closed/),N(e,g)},children:"View"})]})]}),t.jsx("div",{className:"border-b-2 pt-2 mx-[0.5px]"})]},e._id)}),t.jsx(H,{loading:A,setOpen:m,open:l,message:B,deleteFunction:L})]})};export{se as default};
